authentication:
  login_type: form
  login_url: "http://172.20.208.1:3002/#/login"

  # Current active account (Admin)
  credentials:
    username: "admin@juice-sh.op"
    password: "admin123"

  # Improved login flow for OWASP Juice Shop SPA
  login_flow:
    - "1. Navigate to http://172.20.208.1:3002/#/login"
    - "2. Dismiss Welcome Modal: Click 'Close Welcome Banner' (button with aria-label='Close Welcome Banner' or ref e97). This is CRITICAL as it blocks the screen."
    - "3. Dismiss Cookie Banner: Click 'Me want it!' (button with aria-label='dismiss cookie message' or ref e5)."
    - "4. Enter Email: Click input#email (ref e50) first to focus, then type 'admin@juice-sh.op'."
    - "5. Enter Password: Click input#password (ref e58) first to focus, then type 'admin123'."
    - "6. Enable Login Button: Press 'Tab' (browser_press_key) to trigger Angular validation. Ensure button#loginButton (ref e68?) is no longer disabled."
    - "7. Click Login: Click button#loginButton."
    - "8. Confirm: Wait for URL to include '/#/search'."

  # Success condition
  success_condition:
    type: url_contains
    value: "/#/search"

# Detailed application profile for Juice Shop
profile:
  application_overview: |
    OWASP Juice Shop is a modern, intentionally insecure web application written in Node.js, Express, and Angular.
    It is designed for security training and CTF challenges.
    The application follows a Single Page Application (SPA) architecture where the frontend (Angular)
    communicates with a RESTful backend API.

    Key features:
    - User registration and authentication
    - Product search and reviews
    - Shopping cart and checkout system
    - Admin dashboard for user and feedback management
    - File upload functionality
    - Chatbot and customer feedback

  technology_stack: |
    Frontend: Angular (SPA)
    Backend: Node.js, Express
    Database: SQLite (using Sequelize ORM)
    Search: In-memory/File-based search
    Other: Socket.io for chat, JWT for session management

  api_endpoints: |
    Authentication:
    - POST /rest/user/login - User login (returns JWT)
    - POST /api/Users - User registration
    - GET /rest/user/whoami - Check current user session

    Products & Reviews:
    - GET /rest/products/search?q={query} - Search products (vulnerable to SQLi)
    - GET /api/Products - List all products
    - POST /api/Feedbacks - Submit feedback
    - GET /api/Complaints - Submit complaints

    Administration:
    - GET /api/Users - List users (Admin only)
    - DELETE /api/Users/{id} - Delete user (Admin only)
    - GET /rest/admin/application-configuration - App settings

    Other:
    - POST /api/Cards - Add credit card (vulnerable to IDOR)
    - GET /api/BasketItems - Get items in cart

  business_logic: |
    - Checkout flow: Add items to basket -> select address -> select payment -> confirm order.
    - Password reset: Security questions are used for recovery.
    - Discount codes: Can be applied during checkout.
    - Referral system: Allows users to refer others.

  security_controls: |
    - JWT stored in Browser Session/LocalStorage.
    - Client-side validation is present but can be bypassed via direct API calls.
    - Some endpoints have basic authorization checks.
    - Error messages are often verbose, exposing internal structure.

  custom_notes: |
    - Focus on SQLi in the search functionality.
    - Check for IDOR in /api/Cards and /api/BasketItems.
    - Look for XSS in the product reviews and search results.
    - Investigate potential for Broken Access Control in the Admin section.
    - The Welcome Banner and Cookie popup can sometimes interfere with Playwright actions if not dismissed.

rules:
  focus:
    - description: "User and permission related APIs"
      type: path
      url_path: "/api/Users/*"

    - description: "Payment and card management (IDOR/Logic suspects)"
      type: path
      url_path: "/api/Cards/*"

    - description: "Product search and DB queries (Injection suspects)"
      type: path
      url_path: "/rest/products/search*"

  avoid:
    - description: "Static assets and library files"
      type: path
      url_path: "/assets/*"

    - description: "Logout functionality (to keep session)"
      type: path
      url_path: "/#/logout"
