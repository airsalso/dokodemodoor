# This section above is metadata and not part of the prompt.
<!-- BEGIN:COMMON -->
**IF you are not already logged in when you open playwright, these are the login instructions**
**NOTE: playwright automatically saves sessions so ensure you are not already logged in before executing these steps**

## User Configuration

{{user_instructions}}

## Authentication Execution

Execute the login flow based on the login_type specified in the configuration:
<!-- END:COMMON -->

<!-- BEGIN:FORM -->
**Form-based authentication:**
1. Navigate to {{LOGIN_URL}} using Playwright
2. Execute each step in the login_flow array sequentially:
   - Replace $username with the provided username credential
   - Replace $password with the provided password credential
   - Replace $totp with generated code using the `generate_totp` MCP tool with the TOTP secret: {{totp_secret}}
   - If a fixed OTP code is provided (totp_code), input that value directly
   - Perform the specified actions (type text, click buttons, etc.)
   - If a step is conditional (e.g., contains phrases like \"if\", \"있다면\", \"optional\", \"may appear\"), first check whether the target element exists; if not present, SKIP that step without failing
   - For dismiss/close actions (banners, popups), treat missing elements as a no-op and continue
3. Wait for page navigation/loading to complete after each critical step
4. Handle any consent dialogs or "Continue as [user]" prompts by clicking appropriate buttons
<!-- END:FORM -->

<!-- BEGIN:SSO -->
**SSO authentication:**
1. Navigate to {{LOGIN_URL}} using Playwright
2. Execute each step in the login_flow array sequentially:
   - Click the SSO provider button (e.g., "Sign in with Google")
   - Handle account selection if prompted
   - Replace $username with the provided username credential in provider login
   - Replace $password with the provided password credential in provider login
   - Replace $totp with generated code using the `generate_totp` MCP tool with the TOTP secret: {{totp_secret}}
   - Handle OAuth consent screens by clicking "Allow", "Accept", or "Continue", and hitting check boxes as needed.
   - Handle "Continue as [username]" dialogs by clicking "Continue"
3. Wait for OAuth callback and final redirect to complete
4. Ensure all consent and authorization steps are explicitly handled
<!-- END:SSO -->

<!-- BEGIN:VERIFICATION -->

## Success Verification

After completing the login flow, verify successful authentication:

1. **Check Success Condition:**
   - IF success_condition.type == "url_contains": Verify current URL contains the specified value
   - IF success_condition.type == "url_equals_exactly": Verify current URL exactly matches the specified value
   - IF success_condition.type == "element_present": Verify the specified element exists on the page
   - IF success_condition is missing/empty: infer login success by (a) URL not containing login/signin and (b) logout/user menu/avatar or auth token present

2. **Confirm Authentication State:**
   - Page should NOT be on a login screen
   - Page should NOT show authentication errors
   - Page should display authenticated user content/interface

### Tips for SPAs & Modern Apps:
- **Disabled Buttons**: If the Login button remains disabled after entering credentials:
  - Clicking outside the input (blur) to trigger validation
  - Pressing `Tab` to shift focus and trigger events
  - Using `page.type` instead of `page.fill` for the last few characters
  - Ensure any overlaying "Welcome" or "Cookie" banners are definitely dismissed
- **Navigation**: Many SPAs (React/Angular apps) do NOT trigger a full page reload upon login. Use `waitForURL` or check for URL perubahan/state changes instead of relying on `waitForNavigation`.

3. **Verification Success:**
   - Login is successful - proceed with your primary task
   - You now have an authenticated browser session to work with

4. **Verification Failure:**
   - Retry the entire login flow ONCE with 5-second wait between attempts
   - If second attempt fails, report authentication failure and stop task execution
   - Do NOT proceed with authenticated actions if login verification fails

## Error Handling

If login execution fails:
1. Log the specific step that failed and any error messages
2. Check for unexpected dialogs, pop-ups, or consent screens that may need handling
3. Retry the complete login flow once after a 5-second delay
4. If retry fails, report login failure and halt task execution
5. Do NOT attempt to proceed with the primary task if authentication is unsuccessful

Common issues to watch for:
- OAuth consent screens requiring explicit "Allow" or "Accept" clicks
- "Continue as [user]" or account selection prompts
- TOTP/2FA code timing issues requiring regeneration
- Page loading delays requiring explicit waits
- Redirect handling for multi-step authentication flows
- If verification fails, capture a DOM snapshot and record auth indicator keys (cookies/localStorage/sessionStorage) without exposing sensitive values

<!-- END:VERIFICATION -->
